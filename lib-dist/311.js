"use strict";(self.webpackChunkSDK=self.webpackChunkSDK||[]).push([[311],{13:(e,t,a)=>{function r(e){const t=Object.keys(e);return 1===t.length?t[0]:void 0}a.d(t,{m:()=>r})},973:(e,t,a)=>{a.d(t,{Z:()=>r});class r{_logName="";constructor(e){this._logName=e}get deviceInfo(){return{type:"desktop",isDesktop:()=>!0,isMobile:()=>!1,isTablet:()=>!1,isTV:()=>!1}}async getPlayerData(e){const t=JSON.parse(function(e){try{return localStorage.getItem("DATA")}catch{return null}}()??"{}");if(void 0===e)return t;const a={};for(const r of e)a[r]=t[r];return a}async setPlayerData(e){!function(e,t){try{localStorage.setItem("DATA",t)}catch{return}}(0,JSON.stringify(e))}log(...e){console.log(`%c[${this._logName}]:`,"background: wheat; color: #1E324B; font-family: tahoma, verdana, helvetica, arial; font-size: 14px; font-weight: 900; text-align: center; padding: 6px 2px; border-radius: 6px; border: 2px solid #434975",...e)}}},311:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var r=a(602),s=a(13),i=a(983),n=a(973);class l extends n.Z{_getLoginStatusCallbackReceived=new r.FK;_registerUserCallbackReceived=new r.FK;_getAuthTokenCallbackReceived=new r.FK;_userInfoCallbackReceived=new r.FK;_adsCallbackReceived=new r.FK;_paymentCompletedCallbackReceived=new r.FK;_confirmWindowClosedCallbackReceived=new r.FK;_userConfirmCallbackReceived=new r.FK;_getGameInventoryItemsReceived=new r.FK;_userProfileCallbackReceived=new r.FK;_userFriendsCallbackReceived=new r.FK;_userSocialFriendsCallbackReceived=new r.FK;_adErrorReceived=new r.FK;_adStartedReceived=new r.FK;_adCompletedReceived=new r.FK;_gamePauseReceived=new r.FK;_gameStartReceived=new r.FK;_rewardedRewardReceived=new r.FK;_overridedProductsCatalog=[];_isDraft;_appID;_lang;_callbacks;_player=null;_sdk=null;_playerInfo=null;_isAuthorized=!1;constructor(){super((0,s.m)({VKPlaySDKWrapper:l}));const e=new URL(location.href).searchParams;this._isDraft=location.href.startsWith("https://astetrio.github.io/web-games/draft/"),this._appID=e.get("appid")??"0",this._lang=e.get("lang")??"ru_RU",this._callbacks={appid:this._appID,getLoginStatusCallback:e=>{this._getLoginStatusCallbackReceived.dispatch(e),this.log(`getLoginStatusCallback(${JSON.stringify(e)})`)},registerUserCallback:e=>{"ok"==e.status&&(this._isAuthorized=!0,this._playerInfo=e),this._registerUserCallbackReceived.dispatch(e),this.log(`registerUserCallback(${JSON.stringify(e)})`)},getAuthTokenCallback:e=>{this._getAuthTokenCallbackReceived.dispatch(e),this.log(`getAuthTokenCallback(${JSON.stringify(e)})`)},userInfoCallback:e=>{"ok"==e.status&&(this._isAuthorized=!0,this._playerInfo=e),this._userInfoCallbackReceived.dispatch(e),this.log(`userInfoCallback(${JSON.stringify(e)})`)},adsCallback:e=>{this._adsCallbackReceived.dispatch(e),"adError"==e.type&&this._adErrorReceived.dispatch(new Error(e.code));let t=!1;"adCompleted"==e.type&&(this._rewardedRewardReceived.dispatch(),t=!0),setTimeout((()=>{this._adCompletedReceived.dispatch(t),this._gameStartReceived.dispatch()}),1e3),this.log(`adsCallback(${JSON.stringify(e)})`)},paymentWaitCallback:e=>{this.log(`paymentWaitCallback(${JSON.stringify(e)})`)},paymentReceivedCallback:e=>{this._paymentCompletedCallbackReceived.dispatch({status:"received",uid:e.uid}),this.log(`paymentReceivedCallback(${JSON.stringify(e)})`)},paymentWindowClosedCallback:()=>{this._paymentCompletedCallbackReceived.dispatch({status:"closed"}),this.log("paymentWindowClosedCallback")},confirmWindowClosedCallback:()=>{this._confirmWindowClosedCallbackReceived.dispatch(),this.log("confirmWindowClosedCallback")},userConfirmCallback:()=>{this._userConfirmCallbackReceived.dispatch(),this.log("userConfirmCallback")},getGameInventoryItems:()=>{this._getGameInventoryItemsReceived.dispatch(),this.log("getGameInventoryItems")},userProfileCallback:e=>{this._userProfileCallbackReceived.dispatch(e),this.log(`userProfileCallback(${JSON.stringify(e)})`)},userFriendsCallback:e=>{this._userFriendsCallbackReceived.dispatch(e),this.log(`userFriendsCallback(${JSON.stringify(e)})`)},userSocialFriendsCallback:e=>{this._userSocialFriendsCallbackReceived.dispatch(e),this.log(`userSocialFriendsCallback(${JSON.stringify(e)})`)}}}get contentPauseRequested(){return this._gamePauseReceived.asEvent()}get contentContinueRequested(){return this._gameStartReceived.asEvent()}get adOpened(){return this._adStartedReceived.asEvent()}get adClosed(){return this._adCompletedReceived.asEvent()}get rewardedRewardReceived(){return this._rewardedRewardReceived.asEvent()}get canShowAdOnLoading(){return!0}get locale(){let e=i.g.Russian;switch(this.lang){case"ru":case"be":case"kk":case"uk":case"uz":e=i.g.Russian;break;case"tr":e=i.g.Turkish;break;case"de":e=i.g.Deutsch;break;default:e=i.g.English}return e}get lang(){return this._lang.substring(0,2)}get tld(){return this._lang}get id(){return this._appID}get isAuthorized(){return this._isAuthorized}get isDraft(){return this._isDraft}async initialize(){const e=document.createElement("script");return e.src=`//vkplay.ru/app/${this._appID}/static/mailru.core.js`,document.head.appendChild(e),new Promise((t=>{e.addEventListener("load",(()=>{window.iframeApi(this._callbacks,{debug:this._isDraft}).then((async e=>{this._sdk=e,await this.getPlayer(),t()})).catch((e=>{throw new Error("Could not init external api "+e)}))}))}))}ready(){this.log("Ready")}gameplayStart(){this.log("Gameplay Start")}gameplayStop(){this.log("Gameplay Stop")}happyTime(){this.log("Happy Time")}async isMe(e){return null==this._playerInfo?Promise.reject():e==this._playerInfo.uid.toString()}async authorizePlayer(){return this._sdk?.authUser(),Promise.reject()}async getPlayer(){return null!==this._player?this._player:new Promise(((e,t)=>{this._getLoginStatusCallbackReceived.one((async a=>{if("error"!=a.status){if(1==a.loginStatus&&await new Promise(((e,t)=>{this._registerUserCallbackReceived.one((a=>{"error"!=a.status?e():t(a.errmsg)})),this._sdk?.registerUser()})),a.loginStatus>1)return this._userProfileCallbackReceived.one((a=>{"error"!=a.status?(this._player={get isAuthorized(){return!0},get hasNamePermission(){return!0},get hasPhotoPermission(){return!0},get name(){return a.nick},get photo(){return{small:a.avatar,medium:a.avatar,large:a.avatar}},get uuid(){return a.slug}},this._sdk?.userInfo(),e(this._player)):t(a.errmsg)})),void this._sdk?.userProfile();this._player={get isAuthorized(){return!1},get hasNamePermission(){return!1},get hasPhotoPermission(){return!1},get name(){return""},get photo(){return{small:"",medium:"",large:""}},get uuid(){return""}},e(this._player)}else t(a.errmsg)})),this._sdk?.getLoginStatus()}))}sendAnalyticsEvent(e,t){this.log(`Analytic event sended (${e}) with data: ${JSON.stringify(t)}`)}showInterstitial(){this._gamePauseReceived.dispatch(),this._adStartedReceived.dispatch(),this._sdk?.showAds({interstitial:!0})}showRewarded(){this._gamePauseReceived.dispatch(),this._adStartedReceived.dispatch(),this._sdk?.showAds({interstitial:!1})}async canReview(){return Promise.resolve({value:!1,reason:"UNKNOWN"})}async requestReview(){return Promise.reject()}async getPurchasedProducts(){const e=[];return e.signature="",Promise.resolve(e)}overrideProductsCatalog(e){this._overridedProductsCatalog.length=0,this._overridedProductsCatalog.push(...e)}async getProductCatalog(){return Promise.resolve(this._overridedProductsCatalog)}async purchaseProduct(e,t){return new Promise(((a,r)=>{const s=this._overridedProductsCatalog.find((t=>t.id==e));if(null==s||null==s.prices.RUB||s.prices.RUB<=0)return void r();let i;switch(this._paymentCompletedCallbackReceived.one((s=>{"closed"!=s.status?a({purchaseData:{productID:e,purchaseTime:0,purchaseToken:s.uid.toString(),developerPayload:t},signature:""}):r()})),this.lang){case"ru":i=s.meta.ru;break;case"tr":i=s.meta.tr;break;case"de":i=s.meta.de;break;default:i=s.meta.en}i?.description||(i=s.meta.en),this._sdk?.paymentFrame({merchant_param:{amount:s.prices.RUB,item_id:s.id,description:i.description,currency:"RUB",currency_auto_convert:!0}})}))}async consumeProduct(e){return this.log(`Product with token (${e}) consumed`),Promise.resolve()}async setLeaderboardScore(e,t,a){return this.log(`Set leaderboard (${e}) score (${t}) with extraData (${a})`),Promise.resolve()}async getLeaderboardEntries(e,t,a,r){const s={leaderboard:{name:e,dÐµfault:!1,description:{invert_sort_order:!1,score_format:{options:{decimal_offset:0}},type:"numeric"}},ranges:[],userRank:0,entries:[]};a??=5;for(let e=a;e>0;e--){const t={score:Math.round(1e3*Math.random()+1e3*e),extraData:"",rank:a-e+1,player:{get isAuthorized(){return!0},get hasNamePermission(){return!0},get hasPhotoPermission(){return!0},get name(){return"Debug Name"},get photo(){return{small:"https://i.pravatar.cc/256?i="+e,medium:"https://i.pravatar.cc/256?i="+e,large:"https://i.pravatar.cc/256?i="+e}},get uuid(){return""}},formattedScore:""};s.entries.push(t)}return Promise.resolve(s)}async getFlags(e){return e.defaultFlags??{}}}}}]);